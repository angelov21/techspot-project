<!DOCTYPE html>
<html>

<head>
    <title>{{title}}</title>
    <link rel='stylesheet' href='./stylesheets/style.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-route.js"></script>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous"> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <link href='./stylesheets/bootstrap.min.css' rel="stylesheet" />
</head>

<body>

    <ul class="nav navbar-nav">
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
            </ul>
        </li>
    </ul>
    <form action="#!" method="GET" class="navbar-form navbar-left" role="search">
        <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
    </form>

    <ul class="nav nav-pills pull-right">
        <li><a href="#">Home</a></li>
        <li><a href="#!/login">Вход</a></li>
        <li><a href="#!/registration">Регистрация</a></li>
    </ul>
    <br/><br/><br/>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a href="#!phones">Телефони и таблети</a></li>
                    <li><a href="#!tvs">Телевизори</a></li>
                    <li><a href="#!computers">Компютри</a></li>
                    <li><a href="#!homeappliances">Домакински електроуреди</a></li>
                    <li><a href="#!smallappliances">Малки електроуреди</a></li>
                    <li><a href="#!conditioners">Климатици и отопление</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main ng-app='myApp'>
        <div ng-view></div>

        <script>
            var app = angular.module("myApp", ["ngRoute"]);
            app.config(function($routeProvider) {
                $routeProvider
                    .when("/login", {
                        templateUrl: "login.htm"
                    })
                    .when("/registration", {
                        templateUrl: "registration.htm"
                    })
                    .when("/phones", {
                        templateUrl: "phones.htm"
                    });
            });
            app.controller("phonesCtrl", function($scope, $http) {
                $scope.pageTitle = "Мобилни телефони";
                $http.get("/phones").then(function(response) {
                    response.data.sort((p1, p2) => p1.price - p2.price);
                    $scope.phones = response.data;
                    print(response.data);
                });

                function onlyUnique(value, index, self) {
                    return self.indexOf(value) === index;
                }

                function sort(arr) {
                    arr.sort(function(arr1, arr2) {
                        if (arr1 > arr2)
                            return 1;
                        if (arr1 < arr2)
                            return -1;
                        return 0;
                    })
                }

                function print(data) {
                    var brands = data.map((phone) => phone.brand);
                    brands = brands.filter(onlyUnique);
                    sort(brands);
                    $scope.brands = brands;
                    var displaySizes = data.map((phone) => phone.displaysize);
                    displaySizes = displaySizes.filter(onlyUnique);
                    sort(displaySizes);
                    $scope.displaySizes = displaySizes;
                    var rearCameras = data.map((phone) => phone.rearcamera);
                    rearCameras = rearCameras.filter(onlyUnique);
                    sort(rearCameras.map(x => parseFloat(x)));
                    $scope.rearCameras = rearCameras;
                    var iternalMemory = data.map((phone) => phone.iternalmemory);
                    iternalMemory = iternalMemory.filter(onlyUnique);
                    iternalMemory = iternalMemory.map(x => parseFloat(x)).sort((x1, x2) => x1 - x2).map(x => x + " GB");
                    $scope.iternalMemory = iternalMemory;
                }
            });
        </script>

    </main>
</body>

</html>